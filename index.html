<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance System - AaDiTeCh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-placeholder {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--primary);
        }
        
        .header-title {
            font-size: 24px;
            font-weight: 600;
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-dark {
            background-color: var(--dark);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 14px;
        }
        
        .attendance-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .attendance-btn {
            padding: 5px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .present {
            background-color: var(--secondary);
            color: white;
        }
        
        .absent {
            background-color: var(--danger);
            color: white;
        }
        
        .late {
            background-color: var(--warning);
            color: white;
        }
        
        .time-display {
            font-size: 10px;
            color: #777;
            margin-top: 3px;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 15px;
        }
        
        .search-box input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .search-box button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .option-card {
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option-card:hover {
            border-color: var(--primary);
        }
        
        .option-card.active {
            border-color: var(--primary);
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .range-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .range-option {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
            text-align: center;
        }
        
        .range-option.active {
            border-color: var(--primary);
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--dark);
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background: var(--secondary);
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            align-items: center;
            gap: 5px;
            z-index: 1000;
        }
        
        .connection-status.offline {
            background: var(--danger);
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .login-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            background: #4285F4;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .attendance-actions {
                flex-direction: column;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
            }
        }
        
        .pwa-install-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 12px 18px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 999;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- PWA Install Button -->
    <button id="pwa-install-btn" class="pwa-install-btn">
        <i class="fas fa-download"></i> Install App
    </button>

    <!-- Connection Status -->
    <div id="connection-status" class="connection-status">
        <i class="fas fa-wifi"></i> <span>Online</span>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="login-container">
            <h2 class="login-title">Attendance System Login</h2>
            <p>Sign in with your Google account to access the attendance system across all your devices.</p>
            
            <div class="form-group">
                <input type="email" id="login-email" placeholder="Email address">
            </div>
            <div class="form-group">
                <input type="password" id="login-password" placeholder="Password">
            </div>
            
            <button class="btn btn-primary" onclick="login()" style="width: 100%;">Login / Sign Up</button>
            
            <div style="margin: 20px 0; position: relative; text-align: center;">
                <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #ddd;"></div>
                <span style="background: white; padding: 0 10px; position: relative; z-index: 1;">Or</span>
            </div>
            
            <button id="google-signin-button" class="google-btn">
                <i class="fab fa-google"></i> Sign in with Google
            </button>
            
            <p style="margin-top: 20px; font-size: 14px; color: #777;">
                Use the same Google account on all devices to access your data seamlessly.
            </p>
        </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div id="app-content" style="display: none;">
        <div class="container">
            <header>
                <div class="logo-container">
                    <div class="logo-placeholder">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h1 id="header-title" class="header-title">Attendance System - AaDiTeCh</h1>
                </div>
                <div class="header-controls">
                    <button class="btn btn-dark" onclick="openTitleModal()">
                        <i class="fas fa-edit"></i> Change Title
                    </button>
                    <button class="btn btn-warning" onclick="syncWithFirebase()">
                        <i class="fas fa-sync"></i> Sync Data
                    </button>
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>

            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Total Students</div>
                    <div id="total-students" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Morning Present</div>
                    <div id="morning-present" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Evening Present</div>
                    <div id="evening-present" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Attendance %</div>
                    <div id="attendance-percentage" class="stat-value">0%</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title"><i class="fas fa-users"></i> Student Management</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="roll-number">Roll Number</label>
                        <input type="text" id="roll-number" placeholder="Enter roll number">
                    </div>
                    <div class="form-group">
                        <label for="new-student">Student Name</label>
                        <input type="text" id="new-student" placeholder="Enter student name">
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="addStudent()">
                            <i class="fas fa-plus"></i> Add Student
                        </button>
                    </div>
                </div>
                
                <div class="search-box">
                    <input type="text" id="student-search" placeholder="Search students by name or roll number">
                    <button class="btn btn-secondary" onclick="searchStudents()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Roll No</th>
                            <th>Name</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="students-container">
                        <tr>
                            <td colspan="3" style="text-align: center;">No students added yet. Use the form above to add students.</td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="openImportModal()">
                        <i class="fas fa-file-import"></i> Import Students
                    </button>
                    <button class="btn btn-secondary" onclick="exportStudents()">
                        <i class="fas fa-file-export"></i> Export Students
                    </button>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title"><i class="fas fa-clipboard-check"></i> Attendance</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="attendance-date">Date</label>
                        <input type="date" id="attendance-date">
                    </div>
                    <div class="form-group">
                        <label for="attendance-time">Time</label>
                        <input type="time" id="attendance-time">
                    </div>
                    <div class="form-group">
                        <label for="attendance-session">Session</label>
                        <select id="attendance-session">
                            <option value="morning">Morning</option>
                            <option value="evening">Evening</option>
                            <option value="full-day">Full Day</option>
                        </select>
                    </div>
                    <div class="form-group" style="display: flex; align-items: flex-end; gap: 10px;">
                        <button class="btn btn-primary" onclick="loadAttendanceForDate()">
                            <i class="fas fa-refresh"></i> Load
                        </button>
                        <button class="btn btn-secondary" onclick="markAllPresent()">
                            <i class="fas fa-check"></i> Mark All Present
                        </button>
                        <button class="btn btn-danger" onclick="markAllAbsent()">
                            <i class="fas fa-times"></i> Mark All Absent
                        </button>
                    </div>
                </div>
                
                <div class="search-box">
                    <input type="text" id="attendance-search" placeholder="Search attendance by name or roll number">
                    <button class="btn btn-secondary" onclick="searchAttendance()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Roll No</th>
                                <th>Name</th>
                                <th>Morning</th>
                                <th>Evening</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-body">
                            <tr>
                                <td colspan="5" style="text-align: center;">Add students first to mark attendance</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="saveAttendance()">
                        <i class="fas fa-save"></i> Save Attendance
                    </button>
                    <button class="btn btn-warning" onclick="resetAttendance()">
                        <i class="fas fa-trash"></i> Reset Attendance
                    </button>
                    <button class="btn btn-secondary" onclick="openExportModal()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Export Data</h2>
                <button class="close-btn" onclick="closeExportModal()">&times;</button>
            </div>
            
            <div class="options-container">
                <div class="option-card active" onclick="selectExportFormat('excel')">
                    <i class="fas fa-file-excel" style="font-size: 30px; color: #1D6F42; margin-bottom: 10px;"></i>
                    <div>Excel Format</div>
                </div>
                <div class="option-card" onclick="selectExportFormat('csv')">
                    <i class="fas fa-file-csv" style="font-size: 30px; color: #4CAF50; margin-bottom: 10px;"></i>
                    <div>CSV Format</div>
                </div>
            </div>
            
            <h3 style="margin: 20px 0 10px;">Select Date Range</h3>
            
            <div class="range-options">
                <div class="range-option active" onclick="selectRange('day')">Today</div>
                <div class="range-option" onclick="selectRange('week')">This Week</div>
                <div class="range-option" onclick="selectRange('month')">This Month</div>
                <div class="range-option" onclick="selectRange('year')">This Year</div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start-date">Start Date</label>
                    <input type="date" id="start-date">
                </div>
                <div class="form-group">
                    <label for="end-date">End Date</label>
                    <input type="date" id="end-date">
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="exportData()" style="width: 100%;">
                <i class="fas fa-download"></i> Export Data
            </button>
        </div>
    </div>

    <!-- Title Change Modal -->
    <div id="title-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Change System Title</h2>
                <button class="close-btn" onclick="closeTitleModal()">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="new-title">New Title</label>
                <input type="text" id="new-title" placeholder="Enter new system title">
            </div>
            
            <button class="btn btn-primary" onclick="changeTitle()" style="width: 100%;">
                <i class="fas fa-check"></i> Change Title
            </button>
        </div>
    </div>

    <script>
        // ========== PWA FUNCTIONALITY ==========
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }

        // Handle PWA install prompt
        let deferredPrompt;
        const installButton = document.getElementById('pwa-install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install button
            installButton.style.display = 'flex';
            
            installButton.addEventListener('click', (e) => {
                // Hide the install button
                installButton.style.display = 'none';
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            });
        });

        window.addEventListener('appinstalled', (evt) => {
            // Log the install event
            console.log('PWA was installed');
            installButton.style.display = 'none';
        });

        // ========== GLOBAL VARIABLES ==========
        let students = [];
        let attendance = {};
        let currentDate = new Date();
        let systemTitle = 'Attendance System - AaDiTeCh';
        let exportFormat = 'excel';
        let exportRange = 'day';
        let isOnline = true;
        let currentUser = null;

        // ========== FIREBASE CONFIGURATION ==========
        const firebaseConfig = {
          apiKey: "AIzaSyCCr4oeqoUb-343RgchKbfQllT5aFGhI4M",
          authDomain: "attendance-aaditech.firebaseapp.com",
          databaseURL: "https://attendance-aaditech-default-rtdb.firebaseio.com",
          projectId: "attendance-aaditech",
          storageBucket: "attendance-aaditech.firebasestorage.app",
          messagingSenderId: "784396610079",
          appId: "1:784396610079:web:51aa4ba500d41bc6e6c32a",
          measurementId: "G-CHP37HGJ7S"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // ========== AUTHENTICATION FUNCTIONS ==========
        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'flex';
            document.getElementById('app-content').style.display = 'none';
        }

        function closeLoginModal() {
            if (currentUser) {
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
            }
        }

        function signInWithGoogle() {
            auth.signInWithPopup(googleProvider)
                .then((result) => {
                    currentUser = result.user;
                    closeLoginModal();
                    loadUserData();
                    showNotification('Signed in with Google successfully!');
                })
                .catch((error) => {
                    console.error("Google sign-in error:", error);
                    showNotification('Google sign-in error: ' + error.message, true);
                });
        }

        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    closeLoginModal();
                    loadUserData();
                    showNotification('Logged in successfully!');
                })
                .catch((error) => {
                    signup();
                });
        }

        function signup() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    closeLoginModal();
                    
                    students = [];
                    attendance = {};
                    
                    saveUserData();
                    showNotification('Account created successfully!');
                    
                    renderStudents();
                    renderAttendance();
                    updateStats();
                })
                .catch((error) => {
                    showNotification('Authentication error: ' + error.message, true);
                });
        }

        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                students = [];
                attendance = {};
                renderStudents();
                renderAttendance();
                updateStats();
                showNotification('Logged out successfully!');
                updateConnectionStatus();
                showLoginModal();
            }).catch((error) => {
                showNotification('Logout error: ' + error.message, true);
            });
        }

        // ========== FIREBASE REALTIME DATABASE FUNCTIONS ==========
        function saveUserData() {
            if (!currentUser) return;
            
            const userData = {
                students: students,
                attendance: attendance,
                systemTitle: systemTitle,
                lastUpdated: Date.now()
            };
            
            database.ref('users/' + currentUser.uid).set(userData)
                .then(() => {
                    console.log('Data saved to Firebase!');
                })
                .catch((error) => {
                    showNotification('Error saving to Firebase: ' + error.message, true);
                });
        }

        function loadUserData() {
            if (!currentUser) return;
            
            database.ref('users/' + currentUser.uid).once('value')
                .then((snapshot) => {
                    const userData = snapshot.val();
                    
                    if (userData) {
                        if (userData.students) {
                            students = userData.students;
                            renderStudents();
                        }
                        
                        if (userData.attendance) {
                            attendance = userData.attendance;
                            renderAttendance();
                            updateStats();
                        }
                        
                        if (userData.systemTitle) {
                            systemTitle = userData.systemTitle;
                            document.getElementById('header-title').textContent = systemTitle;
                        }
                        
                        showNotification('Data loaded from Firebase for ' + currentUser.email);
                    } else {
                        showNotification('No data found for this user. Starting fresh.');
                    }
                })
                .catch((error) => {
                    showNotification('Error loading from Firebase: ' + error.message, true);
                });
        }

        function syncWithFirebase() {
            if (currentUser) {
                saveUserData();
                showNotification('Data synced with Firebase for ' + currentUser.email);
            } else {
                showLoginModal();
            }
        }

        // ========== INITIALIZATION ==========
        function init() {
            document.getElementById('header-title').textContent = systemTitle;
            
            setCurrentDateTime();
            
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    closeLoginModal();
                    loadUserData();
                    updateConnectionStatus();
                } else {
                    currentUser = null;
                    showLoginModal();
                    updateConnectionStatus();
                }
            });
            
            document.getElementById('google-signin-button').addEventListener('click', signInWithGoogle);
            
            // Add event listener for search input (Enter key)
            document.getElementById('student-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchStudents();
                }
            });
            
            // Add event listener for attendance search input (Enter key)
            document.getElementById('attendance-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchAttendance();
                }
            });
            
            renderStudents();
            renderAttendance();
            updateStats();
        }

        // ========== UI FUNCTIONS ==========
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connection-status');
            
            if (currentUser) {
                statusElement.innerHTML = `<i class="fas fa-user"></i> <span>${currentUser.email}</span> | <i class="fas fa-wifi"></i> <span>Online</span>`;
                statusElement.className = 'connection-status online';
            } else {
                statusElement.innerHTML = '<i class="fas fa-wifi"></i> <span>Online - Not Signed In</span>';
                statusElement.className = 'connection-status online';
            }
            
            statusElement.style.display = 'flex';
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        function setCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('attendance-date').value = `${year}-${month}-${day}`;
            document.getElementById('attendance-time').value = `${hours}:${minutes}`;
        }

        // ========== STUDENT MANAGEMENT ==========
        function renderStudents() {
            const container = document.getElementById('students-container');
            container.innerHTML = '';
            
            if (students.length === 0) {
                container.innerHTML = '<tr><td colspan="3" style="text-align: center;">No students added yet. Use the form above to add students.</td></tr>';
                document.getElementById('total-students').textContent = '0';
                return;
            }
            
            students.sort((a, b) => a.rollNo.localeCompare(b.rollNo, undefined, {numeric: true, sensitivity: 'base'}));
            
            students.forEach((student, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.rollNo}</td>
                    <td>${student.name}</td>
                    <td>
                        <button class="btn btn-danger" onclick="removeStudent(${index})">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </td>
                `;
                container.appendChild(tr);
            });
            
            document.getElementById('total-students').textContent = students.length;
        }
        
        function addStudent() {
            if (!currentUser) {
                showNotification('Please login first', true);
                showLoginModal();
                return;
            }
            
            const rollInput = document.getElementById('roll-number');
            const nameInput = document.getElementById('new-student');
            const rollNo = rollInput.value.trim();
            const name = nameInput.value.trim();
            
            if (rollNo && name && !students.some(s => s.rollNo === rollNo)) {
                students.push({rollNo, name});
                saveUserData();
                renderStudents();
                renderAttendance();
                updateStats();
                rollInput.value = '';
                nameInput.value = '';
                showNotification('Student added successfully!');
            } else if (students.some(s => s.rollNo === rollNo)) {
                showNotification('This roll number is already in the list.', true);
            } else {
                showNotification('Please enter both roll number and name.', true);
            }
        }
        
        function removeStudent(index) {
            if (confirm('Are you sure you want to remove this student?')) {
                students.splice(index, 1);
                saveUserData();
                renderStudents();
                renderAttendance();
                updateStats();
                showNotification('Student removed successfully!');
            }
        }

        // ========== SEARCH FUNCTIONALITY ==========
        function searchStudents() {
            const searchTerm = document.getElementById('student-search').value.toLowerCase().trim();
            
            if (!searchTerm) {
                renderStudents();
                return;
            }
            
            const filteredStudents = students.filter(student => 
                student.rollNo.toLowerCase().includes(searchTerm) || 
                student.name.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('students-container');
            container.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                container.innerHTML = '<tr><td colspan="3" style="text-align: center;">No students found matching your search.</td></tr>';
                return;
            }
            
            filteredStudents.forEach((student, index) => {
                const originalIndex = students.findIndex(s => s.rollNo === student.rollNo);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.rollNo}</td>
                    <td>${student.name}</td>
                    <td>
                        <button class="btn btn-danger" onclick="removeStudent(${originalIndex})">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </td>
                `;
                container.appendChild(tr);
            });
            
            showNotification(`Found ${filteredStudents.length} student(s) matching your search`);
        }
        
        function searchAttendance() {
            const searchTerm = document.getElementById('attendance-search').value.toLowerCase().trim();
            const dateKey = document.getElementById('attendance-date').value;
            
            if (!searchTerm) {
                renderAttendance();
                return;
            }
            
            const container = document.getElementById('attendance-body');
            container.innerHTML = '';
            
            if (students.length === 0) {
                container.innerHTML = '<tr><td colspan="5" style="text-align: center;">Add students first to mark attendance</td></tr>';
                return;
            }
            
            const filteredStudents = students.filter(student => 
                student.rollNo.toLowerCase().includes(searchTerm) || 
                student.name.toLowerCase().includes(searchTerm)
            );
            
            if (filteredStudents.length === 0) {
                container.innerHTML = '<tr><td colspan="5" style="text-align: center;">No students found matching your search.</td></tr>';
                return;
            }
            
            filteredStudents.forEach((student, index) => {
                const studentAttendance = attendance[dateKey] && attendance[dateKey][student.rollNo] ? 
                    attendance[dateKey][student.rollNo] : {morning: null, evening: null};
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.rollNo}</td>
                    <td>${student.name}</td>
                    <td style="text-align: center; background-color: ${getStatusColor(studentAttendance.morning)}">
                        ${getStatusText(studentAttendance.morning)}
                        ${studentAttendance.morningTime ? `<div class="time-display">${studentAttendance.morningTime}</div>` : ''}
                    </td>
                    <td style="text-align: center; background-color: ${getStatusColor(studentAttendance.evening)}">
                        ${getStatusText(studentAttendance.evening)}
                        ${studentAttendance.eveningTime ? `<div class="time-display">${studentAttendance.eveningTime}</div>` : ''}
                    </td>
                    <td class="attendance-actions">
                        <button class="attendance-btn present" onclick="markAttendance(${students.findIndex(s => s.rollNo === student.rollNo)}, 'morning', 'present')">
                            <i class="fas fa-check"></i> P
                        </button>
                        <button class="attendance-btn absent" onclick="markAttendance(${students.findIndex(s => s.rollNo === student.rollNo)}, 'morning', 'absent')">
                            <i class="fas fa-times"></i> A
                        </button>
                        <button class="attendance-btn late" onclick="markAttendance(${students.findIndex(s => s.rollNo === student.rollNo)}, 'morning', 'late')">
                            <i class="fas fa-clock"></i> L
                        </button>
                        <button class="attendance-btn present" onclick="markAttendance(${students.findIndex(s => s.rollNo === student.rollNo)}, 'evening', 'present')">
                            <i class="fas fa-check"></i> P
                        </button>
                        <button class="attendance-btn absent" onclick="markAttendance(${students.findIndex(s => s.rollNo === student.rollNo)}, 'evening', 'absent')">
                            <i class="fas fa-times"></i> A
                        </button>
                        <button class="attendance-btn late" onclick="markAttendance(${students.findIndex(s => s.rollNo === student.rollNo)}, 'evening', 'late')">
                            <i class="fas fa-clock"></i> L
                        </button>
                    </td>
                `;
                container.appendChild(tr);
            });
            
            showNotification(`Found ${filteredStudents.length} student(s) matching your search`);
        }

        // ========== ATTENDANCE MANAGEMENT ==========
        function loadAttendanceForDate() {
            renderAttendance();
            updateStats();
            showNotification('Attendance loaded for selected date');
        }
        
        function renderAttendance() {
            const container = document.getElementById('attendance-body');
            container.innerHTML = '';
            
            if (students.length === 0) {
                container.innerHTML = '<tr><td colspan="5" style="text-align: center;">Add students first to mark attendance</td></tr>';
                return;
            }
            
            const dateKey = document.getElementById('attendance-date').value;
            
            students.forEach((student, index) => {
                const tr = document.createElement('tr');
                
                const studentAttendance = attendance[dateKey] && attendance[dateKey][student.rollNo] ? 
                    attendance[dateKey][student.rollNo] : {morning: null, evening: null};
                
                tr.innerHTML = `
                    <td>${student.rollNo}</td>
                    <td>${student.name}</td>
                    <td style="text-align: center; background-color: ${getStatusColor(studentAttendance.morning)}">
                        ${getStatusText(studentAttendance.morning)}
                        ${studentAttendance.morningTime ? `<div class="time-display">${studentAttendance.morningTime}</div>` : ''}
                    </td>
                    <td style="text-align: center; background-color: ${getStatusColor(studentAttendance.evening)}">
                        ${getStatusText(studentAttendance.evening)}
                        ${studentAttendance.eveningTime ? `<div class="time-display">${studentAttendance.eveningTime}</div>` : ''}
                    </td>
                    <td class="attendance-actions">
                        <button class="attendance-btn present" onclick="markAttendance(${index}, 'morning', 'present')">
                            <i class="fas fa-check"></i> P
                        </button>
                        <button class="attendance-btn absent" onclick="markAttendance(${index}, 'morning', 'absent')">
                            <i class="fas fa-times"></i> A
                        </button>
                        <button class="attendance-btn late" onclick="markAttendance(${index}, 'morning', 'late')">
                            <i class="fas fa-clock"></i> L
                        </button>
                        <button class="attendance-btn present" onclick="markAttendance(${index}, 'evening', 'present')">
                            <i class="fas fa-check"></i> P
                        </button>
                        <button class="attendance-btn absent" onclick="markAttendance(${index}, 'evening', 'absent')">
                            <i class="fas fa-times"></i> A
                        </button>
                        <button class="attendance-btn late" onclick="markAttendance(${index}, 'evening', 'late')">
                            <i class="fas fa-clock"></i> L
                        </button>
                    </td>
                `;
                container.appendChild(tr);
            });
        }
        
        function getStatusColor(status) {
            switch(status) {
                case 'present': return '#d4edda';
                case 'absent': return '#f8d7da';
                case 'late': return '#fff3cd';
                default: return 'transparent';
            }
        }
        
        function getStatusText(status) {
            switch(status) {
                case 'present': return 'P';
                case 'absent': return 'A';
                case 'late': return 'L';
                default: return '';
            }
        }
        
        function markAttendance(index, session, status) {
            if (!currentUser) {
                showNotification('Please login first', true);
                showLoginModal();
                return;
            }
            
            const dateKey = document.getElementById('attendance-date').value;
            const timeValue = document.getElementById('attendance-time').value;
            const student = students[index];
            
            if (!dateKey) {
                showNotification('Please select a date first!', true);
                return;
            }
            
            if (!attendance[dateKey]) {
                attendance[dateKey] = {};
            }
            
            if (!attendance[dateKey][student.rollNo]) {
                attendance[dateKey][student.rollNo] = {morning: null, evening: null};
            }
            
            attendance[dateKey][student.rollNo][session] = status;
            attendance[dateKey][student.rollNo][`${session}Time`] = timeValue;
            
            saveUserData();
            renderAttendance();
            updateStats();
        }
        
        function markAllPresent() {
            const session = document.getElementById('attendance-session').value;
            const timeValue = document.getElementById('attendance-time').value;
            
            if (session === 'full-day') {
                markAllStatus('morning', 'present', timeValue);
                markAllStatus('evening', 'present', timeValue);
            } else {
                markAllStatus(session, 'present', timeValue);
            }
            
            showNotification(`Marked all as present for ${session}`);
        }
        
        function markAllAbsent() {
            const session = document.getElementById('attendance-session').value;
            const timeValue = document.getElementById('attendance-time').value;
            
            if (session === 'full-day') {
                markAllStatus('morning', 'absent', timeValue);
                markAllStatus('evening', 'absent', timeValue);
            } else {
                markAllStatus(session, 'absent', timeValue);
            }
            
            showNotification(`Marked all as absent for ${session}`);
        }
        
        function markAllStatus(session, status, timeValue) {
            if (!currentUser) {
                showNotification('Please login first', true);
                showLoginModal();
                return;
            }
            
            const dateKey = document.getElementById('attendance-date').value;
            
            if (!dateKey) {
                showNotification('Please select a date first!', true);
                return;
            }
            
            if (!attendance[dateKey]) {
                attendance[dateKey] = {};
            }
            
            students.forEach(student => {
                if (!attendance[dateKey][student.rollNo]) {
                    attendance[dateKey][student.rollNo] = {morning: null, evening: null};
                }
                attendance[dateKey][student.rollNo][session] = status;
                attendance[dateKey][student.rollNo][`${session}Time`] = timeValue;
            });
            
            saveUserData();
            renderAttendance();
            updateStats();
        }
        
        function updateStats() {
            const dateKey = document.getElementById('attendance-date').value;
            let morningPresent = 0;
            let eveningPresent = 0;
            let morningLate = 0;
            let eveningLate = 0;
            let total = students.length;
            
            if (total === 0) {
                document.getElementById('total-students').textContent = '0';
                document.getElementById('morning-present').textContent = '0';
                document.getElementById('evening-present').textContent = '0';
                document.getElementById('attendance-percentage').textContent = '0%';
                return;
            }
            
            if (attendance[dateKey]) {
                students.forEach(student => {
                    if (attendance[dateKey][student.rollNo]) {
                        if (attendance[dateKey][student.rollNo].morning === 'present') morningPresent++;
                        if (attendance[dateKey][student.rollNo].evening === 'present') eveningPresent++;
                        if (attendance[dateKey][student.rollNo].morning === 'late') morningLate++;
                        if (attendance[dateKey][student.rollNo].evening === 'late') eveningLate++;
                    }
                });
            }
            
            const totalPresent = morningPresent + eveningPresent;
            const totalSessions = total * 2;
            const attendancePercentage = totalSessions > 0 ? Math.round((totalPresent / totalSessions) * 100) : 0;
            
            document.getElementById('total-students').textContent = total;
            document.getElementById('morning-present').textContent = morningPresent;
            document.getElementById('evening-present').textContent = eveningPresent;
            document.getElementById('attendance-percentage').textContent = `${attendancePercentage}%`;
        }
        
        function saveAttendance() {
            saveUserData();
            showNotification('Attendance data saved to Firebase!');
        }
        
        function resetAttendance() {
            if (confirm('Are you sure you want to reset attendance for this date?')) {
                const dateKey = document.getElementById('attendance-date').value;
                if (attendance[dateKey]) {
                    delete attendance[dateKey];
                    saveUserData();
                    renderAttendance();
                    updateStats();
                    showNotification('Attendance reset for ' + dateKey);
                } else {
                    showNotification('No attendance data found for ' + dateKey);
                }
            }
        }

        // ========== EXPORT FUNCTIONALITY ==========
        function openExportModal() {
            document.getElementById('export-modal').style.display = 'flex';
            selectRange('day');
        }
        
        function closeExportModal() {
            document.getElementById('export-modal').style.display = 'none';
        }
        
        function selectRange(rangeType) {
            document.querySelectorAll('.range-option').forEach(option => {
                option.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
            
            const today = new Date();
            let startDate, endDate;
            
            switch(rangeType) {
                case 'day':
                    startDate = today;
                    endDate = today;
                    break;
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - today.getDay());
                    endDate = new Date(today);
                    endDate.setDate(today.getDate() + (6 - today.getDay()));
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today.getFullYear(), 11, 31);
                    break;
            }
            
            document.getElementById('start-date').value = formatDate(startDate);
            document.getElementById('end-date').value = formatDate(endDate);
            
            exportRange = rangeType;
        }
        
        function selectExportFormat(format) {
            document.querySelectorAll('.option-card').forEach(option => {
                option.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
            
            exportFormat = format;
        }
        
        function exportData() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (!startDate || !endDate) {
                showNotification('Please select a date range.', true);
                return;
            }
            
            if (exportFormat === 'print') {
                window.print();
                closeExportModal();
                return;
            }
            
            const dateArray = getDatesInRange(startDate, endDate);
            
            let attendanceData = [];
            dateArray.forEach(date => {
                if (attendance[date]) {
                    Object.keys(attendance[date]).forEach(rollNo => {
                        const student = students.find(s => s.rollNo === rollNo);
                        if (student) {
                            attendanceData.push({
                                date: date,
                                rollNo: rollNo,
                                name: student.name,
                                morning: attendance[date][rollNo].morning || 'Not recorded',
                                morningTime: attendance[date][rollNo].morningTime || '',
                                evening: attendance[date][rollNo].evening || 'Not recorded',
                                eveningTime: attendance[date][rollNo].eveningTime || ''
                            });
                        }
                    });
                }
            });
            
            if (attendanceData.length === 0) {
                showNotification('No attendance data found for the selected date range.', true);
                return;
            }
            
            if (exportFormat === 'excel') {
                exportToExcel(attendanceData, startDate, endDate);
            } else if (exportFormat === 'csv') {
                exportToCSV(attendanceData, startDate, endDate);
            }
            
            closeExportModal();
            showNotification(`Data exported successfully for ${dateArray.length} days!`);
        }
        
        function getDatesInRange(startDate, endDate) {
            const dates = [];
            let currentDate = new Date(startDate);
            const end = new Date(endDate);
            
            while (currentDate <= end) {
                dates.push(formatDate(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return dates;
        }
        
        function formatDate(date) {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [year, month, day].join('-');
        }
        
        function exportToExcel(attendanceData, startDate, endDate) {
            const excelData = attendanceData.map(record => ({
                'Date': record.date,
                'Roll No': record.rollNo,
                'Student Name': record.name,
                'Morning': record.morning,
                'Morning Time': record.morningTime,
                'Evening': record.evening,
                'Evening Time': record.eveningTime
            }));
            
            const worksheet = XLSX.utils.json_to_sheet(excelData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Attendance');
            
            XLSX.writeFile(workbook, 'attendance_' + startDate + '_to_' + endDate + '.xlsx');
        }
        
        function exportToCSV(attendanceData, startDate, endDate) {
            let csvContent = "Date,Roll No,Student Name,Morning,Morning Time,Evening,Evening Time\n";
            
            attendanceData.forEach(record => {
                csvContent += `"${record.date}","${record.rollNo}","${record.name}","${record.morning}","${record.morningTime || ''}","${record.evening}","${record.eveningTime || ''}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `attendance_${startDate}_to_${endDate}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ========== NOTIFICATION FUNCTION ==========
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            if (isError) {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ========== TITLE CHANGE FUNCTIONS ==========
        function openTitleModal() {
            document.getElementById('new-title').value = systemTitle;
            document.getElementById('title-modal').style.display = 'flex';
        }
        
        function closeTitleModal() {
            document.getElementById('title-modal').style.display = 'none';
        }
        
        function changeTitle() {
            const newTitle = document.getElementById('new-title').value.trim();
            if (newTitle) {
                systemTitle = newTitle;
                document.getElementById('header-title').textContent = systemTitle;
                saveUserData();
                closeTitleModal();
                showNotification('Title changed successfully!');
            } else {
                showNotification('Title cannot be empty!', true);
            }
        }

        // ========== STUDENT IMPORT/EXPORT ==========
        function openImportModal() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function (evt) {
                    let importedStudents = [];
                    if (file.name.endsWith('.csv')) {
                        const lines = evt.target.result.split('\n');
                        for (let line of lines) {
                            const [rollNo, name] = line.split(',').map(x => x && x.trim());
                            if (rollNo && name && !students.some(s => s.rollNo === rollNo)) {
                                importedStudents.push({ rollNo, name });
                            }
                        }
                    } else {
                        const data = new Uint8Array(evt.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                        for (let row of json) {
                            const [rollNo, name] = row;
                            if (rollNo && name && !students.some(s => s.rollNo === rollNo)) {
                                importedStudents.push({ rollNo: String(rollNo).trim(), name: String(name).trim() });
                            }
                        }
                    }
                    if (importedStudents.length > 0) {
                        students = students.concat(importedStudents);
                        saveUserData();
                        renderStudents();
                        renderAttendance();
                        updateStats();
                        showNotification(`${importedStudents.length} students imported successfully!`);
                    } else {
                        showNotification('No valid students found to import.', true);
                    }
                };
                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsArrayBuffer(file);
                }
            };
            input.click();
        }

        function exportStudents() {
            if (!students.length) {
                showNotification('No students to export.', true);
                return;
            }
            let csv = 'Roll No,Student Name\n';
            students.forEach(s => {
                csv += `"${s.rollNo}","${s.name}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "students.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Students exported successfully!');
        }

        // ========== ONLINE/OFFLINE STATUS ==========
        window.addEventListener('online', () => {
            document.getElementById('connection-status').innerHTML = '<i class="fas fa-wifi"></i> <span>Online</span>';
            document.getElementById('connection-status').className = 'connection-status online';
            document.getElementById('connection-status').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('connection-status').style.display = 'none';
            }, 3000);
        });
        
        window.addEventListener('offline', () => {
            document.getElementById('connection-status').innerHTML = '<i class="fas fa-wifi"></i> <span>Offline</span>';
            document.getElementById('connection-status').className = 'connection-status offline';
            document.getElementById('connection-status').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('connection-status').style.display = 'none';
            }, 3000);
        });

        // Initialize the application
        window.onload = init;
    </script>
</body>
</html>
